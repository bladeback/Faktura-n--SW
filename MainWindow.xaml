<Window x:Class="InvoiceApp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:InvoiceApp.ViewModels"
        Title="InvoiceApp"
        Height="720"
        Width="1200">
        <Window.Resources>
                <BooleanToVisibilityConverter x:Key="BoolToVis"/>
        </Window.Resources>

        <Window.DataContext>
                <vm:MainViewModel/>
        </Window.DataContext>

        <DockPanel>
                <!-- Toolbar -->
                <ToolBar DockPanel.Dock="Top">
                        <Button Content="Nová faktura"
                                Command="{Binding NewInvoiceCommand}"/>
                        <Button Content="Nová objednávka"
                                Command="{Binding NewOrderCommand}"
                                Margin="6,0,0,0"/>
                        <Separator/>
                        <Button Content="Přidat položku"
                                Command="{Binding AddItemCommand}"/>
                        <Button Content="Export do PDF"
                                Command="{Binding ExportPdfCommand}"
                                Margin="6,0,0,0"/>
                </ToolBar>

                <Grid Margin="8">
                        <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="420"/>
                                <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Levá část (scroll) -->
                        <ScrollViewer Grid.Column="0"
                                      VerticalScrollBarVisibility="Auto">
                                <StackPanel Margin="0,0,10,0">

                                        <!-- Doklad -->
                                        <GroupBox Header="Doklad">
                                                <Grid Margin="8">
                                                        <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="120"/>
                                                                <ColumnDefinition Width="*"/>
                                                        </Grid.ColumnDefinitions>
                                                        <Grid.RowDefinitions>
                                                                <RowDefinition Height="Auto"/>
                                                                <RowDefinition Height="Auto"/>
                                                                <RowDefinition Height="Auto"/>
                                                                <RowDefinition Height="Auto"/>
                                                        </Grid.RowDefinitions>

                                                        <TextBlock Grid.Row="0"
                                                                   Grid.Column="0"
                                                                   Text="Typ:"
                                                                   VerticalAlignment="Center"/>
                                                        <ComboBox Grid.Row="0"
                                                                  Grid.Column="1"
                                                                  SelectedValue="{Binding Current.Type}"
                                                                  Margin="6,0,0,4">
                                                                <ComboBoxItem Content="Faktura"/>
                                                                <ComboBoxItem Content="Objednávka"/>
                                                        </ComboBox>

                                                        <TextBlock Grid.Row="1"
                                                                   Grid.Column="0"
                                                                   Text="Číslo:"
                                                                   VerticalAlignment="Center"/>
                                                        <TextBox   Grid.Row="1"
                                                                   Grid.Column="1"
                                                                   Text="{Binding Current.Number}"
                                                                   Margin="6,0,0,4"/>

                                                        <TextBlock Grid.Row="2"
                                                                   Grid.Column="0"
                                                                   Text="Vystaveno:"
                                                                   VerticalAlignment="Center"/>
                                                        <DatePicker Grid.Row="2"
                                                                    Grid.Column="1"
                                                                    SelectedDate="{Binding Current.IssueDate}"
                                                                    Margin="6,0,0,4"/>

                                                        <TextBlock Grid.Row="3"
                                                                   Grid.Column="0"
                                                                   Text="Splatnost:"
                                                                   VerticalAlignment="Center"/>
                                                        <DatePicker Grid.Row="3"
                                                                    Grid.Column="1"
                                                                    SelectedDate="{Binding Current.DueDate}"
                                                                    Margin="6,0,0,0"/>
                                                </Grid>
                                        </GroupBox>

                                        <!-- Dodavatel -->
                                        <GroupBox Header="Dodavatel"
                                                  Margin="0,10,0,0">
                                                <Grid Margin="8">
                                                        <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="120"/>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="Auto"/>
                                                        </Grid.ColumnDefinitions>
                                                        <Grid.RowDefinitions>
                                                                <RowDefinition Height="Auto"/>
                                                                <!-- Název -->
                                                                <RowDefinition Height="Auto"/>
                                                                <!-- Ulice a č.p. -->
                                                                <RowDefinition Height="Auto"/>
                                                                <!-- PSČ a obec -->
                                                                <RowDefinition Height="Auto"/>
                                                                <!-- IČO -->
                                                                <RowDefinition Height="Auto"/>
                                                                <!-- DIČ -->
                                                                <RowDefinition Height="Auto"/>
                                                                <!-- Banka -->
                                                                <RowDefinition Height="Auto"/>
                                                                <!-- Účet -->
                                                                <RowDefinition Height="Auto"/>
                                                                <!-- IBAN -->
                                                                <RowDefinition Height="Auto"/>
                                                                <!-- E-mail -->
                                                                <RowDefinition Height="Auto"/>
                                                                <!-- Telefon -->
                                                                <RowDefinition Height="Auto"/>
                                                                <!-- Plátce DPH -->
                                                        </Grid.RowDefinitions>

                                                        <!-- Název -->
                                                        <TextBlock Grid.Row="0"
                                                                   Grid.Column="0"
                                                                   Text="Název:"
                                                                   VerticalAlignment="Center"/>
                                                        <TextBox   Grid.Row="0"
                                                                   Grid.Column="1"
                                                                   Text="{Binding Current.Supplier.Name}"
                                                                   Margin="6,0,0,4"/>

                                                        <!-- Ulice a č.p. -->
                                                        <TextBlock Grid.Row="1"
                                                                   Grid.Column="0"
                                                                   Text="Ulice a č.p.:"
                                                                   VerticalAlignment="Center"/>
                                                        <TextBox   Grid.Row="1"
                                                                   Grid.Column="1"
                                                                   Text="{Binding Current.Supplier.Address}"
                                                                   Margin="6,0,0,4"/>

                                                        <!-- PSČ a obec -->
                                                        <TextBlock Grid.Row="2"
                                                                   Grid.Column="0"
                                                                   Text="PSČ a obec:"
                                                                   VerticalAlignment="Center"/>
                                                        <TextBox   Grid.Row="2"
                                                                   Grid.Column="1"
                                                                   Text="{Binding Current.Supplier.City}"
                                                                   Margin="6,0,0,4"/>

                                                        <!-- IČO + ARES -->
                                                        <TextBlock Grid.Row="3"
                                                                   Grid.Column="0"
                                                                   Text="IČO:"
                                                                   VerticalAlignment="Center"/>
                                                        <TextBox   Grid.Row="3"
                                                                   Grid.Column="1"
                                                                   Text="{Binding Current.Supplier.ICO}"
                                                                   Margin="6,0,0,4"/>
                                                        <Button    Grid.Row="3"
                                                                   Grid.Column="2"
                                                                   Content="Načíst z ARES"
                                                                   Margin="6,0,0,4"
                                                                   Command="{Binding LoadSupplierFromIcoCommand}"/>

                                                        <!-- DIČ -->
                                                        <TextBlock Grid.Row="4"
                                                                   Grid.Column="0"
                                                                   Text="DIČ:"
                                                                   VerticalAlignment="Center"/>
                                                        <TextBox   Grid.Row="4"
                                                                   Grid.Column="1"
                                                                   Text="{Binding Current.Supplier.DIC}"
                                                                   Margin="6,0,0,4"/>

                                                        <!-- Banka -->
                                                        <TextBlock Grid.Row="5"
                                                                   Grid.Column="0"
                                                                   Text="Banka:"
                                                                   VerticalAlignment="Center"/>
                                                        <TextBox   Grid.Row="5"
                                                                   Grid.Column="1"
                                                                   Text="{Binding Current.Supplier.Bank}"
                                                                   Margin="6,0,0,4"/>

                                                        <!-- Účet (domácí číslo účtu) -->
                                                        <TextBlock Grid.Row="6"
                                                                   Grid.Column="0"
                                                                   Text="Účet:"
                                                                   VerticalAlignment="Center"/>
                                                        <TextBox   Grid.Row="6"
                                                                   Grid.Column="1"
                                                                   Text="{Binding Current.Supplier.AccountNumber}"
                                                                   Margin="6,0,0,4"/>

                                                        <!-- IBAN -->
                                                        <TextBlock Grid.Row="7"
                                                                   Grid.Column="0"
                                                                   Text="IBAN:"
                                                                   VerticalAlignment="Center"/>
                                                        <TextBox   Grid.Row="7"
                                                                   Grid.Column="1"
                                                                   Text="{Binding Current.Supplier.IBAN}"
                                                                   Margin="6,0,0,4"/>

                                                        <!-- E-mail -->
                                                        <TextBlock Grid.Row="8"
                                                                   Grid.Column="0"
                                                                   Text="E-mail:"
                                                                   VerticalAlignment="Center"/>
                                                        <TextBox   Grid.Row="8"
                                                                   Grid.Column="1"
                                                                   Text="{Binding Current.Supplier.Email}"
                                                                   Margin="6,0,0,4"/>

                                                        <!-- Telefon -->
                                                        <TextBlock Grid.Row="9"
                                                                   Grid.Column="0"
                                                                   Text="Telefon:"
                                                                   VerticalAlignment="Center"/>
                                                        <TextBox   Grid.Row="9"
                                                                   Grid.Column="1"
                                                                   Text="{Binding Current.Supplier.Phone}"
                                                                   Margin="6,0,0,4"/>

                                                        <!-- Plátce DPH (vazba na VM) -->
                                                        <TextBlock Grid.Row="10"
                                                                   Grid.Column="0"
                                                                   Text="Plátce DPH:"
                                                                   VerticalAlignment="Center"/>
                                                        <CheckBox  Grid.Row="10"
                                                                   Grid.Column="1"
                                                                   IsChecked="{Binding SupplierIsVatPayer}"
                                                                   Margin="6,0,0,4"/>
                                                </Grid>
                                        </GroupBox>

                                        <!-- Odběratel -->
                                        <GroupBox Header="Odběratel"
                                                  Margin="0,10,0,10">
                                                <Grid Margin="8">
                                                        <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="120"/>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="Auto"/>
                                                        </Grid.ColumnDefinitions>
                                                        <Grid.RowDefinitions>
                                                                <RowDefinition Height="Auto"/>
                                                                <RowDefinition Height="Auto"/>
                                                                <RowDefinition Height="Auto"/>
                                                                <RowDefinition Height="Auto"/>
                                                                <RowDefinition Height="Auto"/>
                                                        </Grid.RowDefinitions>

                                                        <TextBlock Grid.Row="0"
                                                                   Grid.Column="0"
                                                                   Text="Název:"
                                                                   VerticalAlignment="Center"/>
                                                        <TextBox   Grid.Row="0"
                                                                   Grid.Column="1"
                                                                   Text="{Binding Current.Customer.Name}"
                                                                   Margin="6,0,0,4"/>

                                                        <TextBlock Grid.Row="1"
                                                                   Grid.Column="0"
                                                                   Text="Ulice a č.p.:"
                                                                   VerticalAlignment="Center"/>
                                                        <TextBox   Grid.Row="1"
                                                                   Grid.Column="1"
                                                                   Text="{Binding Current.Customer.Address}"
                                                                   Margin="6,0,0,4"/>

                                                        <TextBlock Grid.Row="2"
                                                                   Grid.Column="0"
                                                                   Text="PSČ a obec:"
                                                                   VerticalAlignment="Center"/>
                                                        <TextBox   Grid.Row="2"
                                                                   Grid.Column="1"
                                                                   Text="{Binding Current.Customer.City}"
                                                                   Margin="6,0,0,4"/>

                                                        <TextBlock Grid.Row="3"
                                                                   Grid.Column="0"
                                                                   Text="IČO:"
                                                                   VerticalAlignment="Center"/>
                                                        <TextBox   Grid.Row="3"
                                                                   Grid.Column="1"
                                                                   Text="{Binding Current.Customer.ICO}"
                                                                   Margin="6,0,0,4"/>
                                                        <Button    Grid.Row="3"
                                                                   Grid.Column="2"
                                                                   Content="Načíst z ARES"
                                                                   Margin="6,0,0,4"
                                                                   Command="{Binding LoadCustomerFromIcoCommand}"/>

                                                        <TextBlock Grid.Row="4"
                                                                   Grid.Column="0"
                                                                   Text="DIČ:"
                                                                   VerticalAlignment="Center"/>
                                                        <TextBox   Grid.Row="4"
                                                                   Grid.Column="1"
                                                                   Text="{Binding Current.Customer.DIC}"
                                                                   Margin="6,0,0,0"/>
                                                </Grid>
                                        </GroupBox>

                                        <!-- Platební údaje -->
                                        <GroupBox Header="Platební údaje">
                                                <Grid Margin="8">
                                                        <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="120"/>
                                                                <ColumnDefinition Width="*"/>
                                                        </Grid.ColumnDefinitions>
                                                        <Grid.RowDefinitions>
                                                                <RowDefinition Height="Auto"/>
                                                                <RowDefinition Height="Auto"/>
                                                                <RowDefinition Height="Auto"/>
                                                        </Grid.RowDefinitions>

                                                        <TextBlock Grid.Row="0"
                                                                   Grid.Column="0"
                                                                   Text="VS:"
                                                                   VerticalAlignment="Center"/>
                                                        <TextBox   Grid.Row="0"
                                                                   Grid.Column="1"
                                                                   Text="{Binding Current.VariableSymbol}"
                                                                   Margin="6,0,0,4"/>

                                                        <TextBlock Grid.Row="1"
                                                                   Grid.Column="0"
                                                                   Text="Měna:"
                                                                   VerticalAlignment="Center"/>
                                                        <TextBox   Grid.Row="1"
                                                                   Grid.Column="1"
                                                                   Text="{Binding Current.Currency}"
                                                                   Margin="6,0,0,4"/>

                                                        <TextBlock Grid.Row="2"
                                                                   Grid.Column="0"
                                                                   Text="Poznámka:"
                                                                   VerticalAlignment="Top"/>
                                                        <!-- OPRAVA: odstraněná přebytečná '}' v Margin -->
                                                        <TextBox   Grid.Row="2"
                                                                   Grid.Column="1"
                                                                   Text="{Binding Current.Notes}"
                                                                   Margin="6,0,0,0"
                                                                   Height="70"
                                                                   AcceptsReturn="True"
                                                                   TextWrapping="Wrap"/>
                                                </Grid>
                                        </GroupBox>

                                </StackPanel>
                        </ScrollViewer>

                        <!-- Pravá část -->
                        <Grid Grid.Column="1">
                                <Grid.RowDefinitions>
                                        <RowDefinition Height="*"/>
                                        <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- Položky -->
                                <DataGrid Grid.Row="0"
                                          ItemsSource="{Binding Items}"
                                          AutoGenerateColumns="False"
                                          CanUserAddRows="False"
                                          HeadersVisibility="Column"
                                          Margin="0,0,0,6">
                                        <DataGrid.Columns>
                                                <DataGridTextColumn Header="Položka"
                                                                    Binding="{Binding Name}"
                                                                    Width="*"/>
                                                <DataGridTextColumn Header="Mj"
                                                                    Binding="{Binding Unit}"
                                                                    Width="60"/>
                                                <DataGridTextColumn Header="Množství"
                                                                    Binding="{Binding Quantity}"
                                                                    Width="100"/>
                                                <DataGridTextColumn Header="Cena/ks"
                                                                    Binding="{Binding UnitPrice}"
                                                                    Width="120"/>
                                                <DataGridTextColumn Header="DPH (%)"
                                                                    Binding="{Binding VatRate}"
                                                                    Width="100"/>
                                                <DataGridTemplateColumn Header=""
                                                                        Width="40">
                                                        <DataGridTemplateColumn.CellTemplate>
                                                                <DataTemplate>
                                                                        <Button Content="✕"
                                                                                Command="{Binding DataContext.RemoveSelectedCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                                                CommandParameter="{Binding}"
                                                                                Padding="0"
                                                                                Margin="4,0,0,0"/>
                                                                </DataTemplate>
                                                        </DataGridTemplateColumn.CellTemplate>
                                                </DataGridTemplateColumn>
                                        </DataGrid.Columns>
                                </DataGrid>

                                <!-- Souhrn vpravo dole -->
                                <Grid Grid.Row="1"
                                      HorizontalAlignment="Right"
                                      Margin="0,0,8,0"
                                      Width="280">
                                        <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="8"/>
                                                <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="140"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Pro plátce: Základ / DPH -->
                                        <TextBlock Grid.Row="0"
                                                   Grid.Column="0"
                                                   Text="Základ bez DPH:"
                                                   Visibility="{Binding SupplierIsVatPayer, Converter={StaticResource BoolToVis}}"/>
                                        <TextBlock Grid.Row="0"
                                                   Grid.Column="1"
                                                   Text="{Binding SubtotalDisplay}"
                                                   HorizontalAlignment="Right"
                                                   Visibility="{Binding SupplierIsVatPayer, Converter={StaticResource BoolToVis}}"/>

                                        <TextBlock Grid.Row="1"
                                                   Grid.Column="0"
                                                   Text="DPH celkem:"
                                                   Visibility="{Binding SupplierIsVatPayer, Converter={StaticResource BoolToVis}}"/>
                                        <TextBlock Grid.Row="1"
                                                   Grid.Column="1"
                                                   Text="{Binding VatTotalDisplay}"
                                                   HorizontalAlignment="Right"
                                                   Visibility="{Binding SupplierIsVatPayer, Converter={StaticResource BoolToVis}}"/>

                                        <Rectangle Grid.Row="2"
                                                   Grid.ColumnSpan="2"
                                                   Height="1"
                                                   Fill="#33000000"
                                                   Visibility="{Binding SupplierIsVatPayer, Converter={StaticResource BoolToVis}}"/>

                                        <!-- Celkem (vždy) -->
                                        <TextBlock Grid.Row="3"
                                                   Grid.Column="0"
                                                   Text="Celkem:"
                                                   FontWeight="Bold"/>
                                        <TextBlock Grid.Row="3"
                                                   Grid.Column="1"
                                                   Text="{Binding GrandTotalDisplay}"
                                                   FontWeight="Bold"
                                                   HorizontalAlignment="Right"/>
                                </Grid>
                        </Grid>
                </Grid>
        </DockPanel>
</Window>
